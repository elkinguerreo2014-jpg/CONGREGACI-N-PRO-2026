<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>Congregación Pro - Master v75</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --bg: #f8fafc; --surface: #ffffff; --card: #ffffff;
            --fg: #0f172a; --muted: #64748b; --border: #e2e8f0; --panel: #f1f5f9;
            --accent: #2563eb; --accent-hover: #1d4ed8; --accent-contrast: #ffffff;
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b; --purple: #8b5cf6;
            --radius-md: 12px; --radius-lg: 20px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        [data-theme="blue"] {
            --bg: #020617; --surface: #0f172a; --card: #1e293b;
            --panel: #334155; --fg: #f1f5f9; --muted: #94a3b8;
            --border: #334155; --accent: #38bdf8; --accent-hover: #7dd3fc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--fg); line-height: 1.5; font-size: 16px; -webkit-tap-highlight-color: transparent; }
        body.readonly header, body.readonly .tabs-container, body.readonly .container { display: none !important; }

        #toast { position: fixed; top: 20px; right: 20px; background: var(--fg); color: var(--surface); padding: 12px 24px; border-radius: 8px; font-weight: 600; box-shadow: var(--shadow); display: none; z-index: 2000; border-left: 5px solid var(--accent); }

        /* HEADER (Por defecto Sticky en PC) */
        header.top { background: var(--surface); border-bottom: 1px solid var(--border); padding: 1rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; flex-wrap: wrap; gap: 10px; }
        
        .tabs-container { background: var(--surface); border-bottom: 1px solid var(--border); padding: 0.5rem 1rem; overflow-x: auto; position: sticky; top: 70px; z-index: 90; -webkit-overflow-scrolling: touch; }
        .tabs { display: flex; gap: 8px; width: max-content; }
        .tabs button { padding: 10px 16px; border: 1px solid transparent; background: transparent; color: var(--muted); font-weight: 600; font-size: 0.85rem; border-radius: 10px; cursor: pointer; white-space: nowrap; }
        .tabs button.active { background: var(--panel); color: var(--accent); border-color: var(--border); }

        .container { max-width: 1600px; margin: 0 auto; padding: 1.5rem; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow); margin-bottom: 1.5rem; overflow: hidden; }
        
        .admin-tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; background: var(--panel); padding: 1.2rem; border-radius: var(--radius-md); margin-bottom: 1.5rem; }

        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s ease; }
        
        /* TABLAS RESPONSIVAS */
        .table-container { overflow-x: auto; border-radius: var(--radius-md); border: 1px solid var(--border); -webkit-overflow-scrolling: touch; }
        .table { width: 100%; border-spacing: 0; border-collapse: separate; background: var(--card); min-width: 600px; }
        .table th { background: var(--panel); color: var(--muted); font-size: 0.75rem; font-weight: 800; padding: 12px; text-align: left; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        .table td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .row-sacado td:first-child { color: var(--danger) !important; font-weight: 800; text-decoration: line-through; }

        /* FORMATOS IMPRESIÓN */
        #preview-viewport, #s88-preview-viewport { overflow-x: auto; padding: 20px; background: #cbd5e1; border-radius: 12px; display:flex; flex-direction:column; align-items:center; }
        .print-canvas { width: 190mm; min-width: 190mm; background: #fff; color: #000; padding: 12mm; border: 2.5px solid #000 !important; font-family: 'Inter', sans-serif; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .print-title { font-size: 13pt; font-weight: 900; text-align: center; margin-bottom: 10px; text-transform: uppercase; border-bottom: 2.5px solid #000; padding-bottom: 5px; }
        .official-table { width: 100%; border-collapse: collapse !important; border: 1.5px solid #000 !important; margin-top: 5px; }
        .official-table th, .official-table td { border: 1.2px solid #000 !important; padding: 4px; font-size: 8.5pt; text-align: center; color: #000; }
        .official-table th { background: #f2f2f2 !important; font-weight: 800; }
        .s21-header-box { border: 1.5px solid #000; padding: 10px; margin-bottom: 10px; font-size: 9pt; line-height: 1.6; }

        .stat-block { background: var(--card); border: 1px solid var(--border); padding: 1.2rem; border-radius: var(--radius-md); border-top: 5px solid var(--accent); box-shadow: var(--shadow); }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .stat-value { font-weight: 800; font-size: 1.3rem; color: var(--fg); }

        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 10px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: var(--surface); color: var(--fg); gap: 6px; transition: 0.2s; font-size: 0.9rem; white-space: nowrap; }
        .btn.primary { background: var(--accent); color: white; border: none; }
        .btn.success { background: var(--success); color: white; border: none; }
        .btn.danger { background: var(--danger); color: white; border: none; }
        .btn.warning { background: var(--warning); color: white; border: none; }
        
        input, select { background: var(--surface); border: 1px solid var(--border); padding: 10px; border-radius: 8px; color: var(--fg); font-size: 0.95rem; width: 100%; }
        label { display: block; font-size: 0.75rem; font-weight: 800; color: var(--muted); margin-bottom: 4px; text-transform: uppercase; }

        #modalAuth { position: fixed; inset: 0; background: rgba(0,0,0,0.96); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .badge-count { background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 800; }

        .asist-grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; }

        /* MEDIA QUERIES (MOVIL) */
        @media (max-width: 768px) {
            /* AQUÍ ESTÁ EL CAMBIO: Quitar Sticky en móvil */
            header.top, .tabs-container { position: relative !important; top: auto !important; z-index: 1; }
            
            header.top { flex-direction: column; align-items: stretch; gap: 15px; padding: 1rem 1rem; }
            header.top > div { justify-content: space-between; width: 100%; }
            .tabs-container { padding: 0.5rem; overflow-x: auto; }
